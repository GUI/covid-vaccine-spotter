---
pagination:
  data: states
  size: 1
  alias: state
permalink: "<%= state.code %>/"
---

<% title = `${state.name} COVID-19 Vaccine Spotter` %>
<% description = `A tool to help you track down COVID-19 vaccine appointment openings at ${state.name} pharmacies. Updated every minute.` %>

<% const storesScanning = [] %>
<% if (stores?.[state.code]?.cvs) { %>
  <% storesScanning.push("CVS") %>
<% } %>
<% if (stores?.[state.code]?.heb) { %>
  <% storesScanning.push("H-E-B") %>
<% } %>
<% if (stores?.[state.code]?.kroger) { %>
  <% storesScanning.push("King Soopers/City Market") %>
<% } %>
<% if (stores?.[state.code]?.pharmaca) { %>
  <% storesScanning.push("Pharmaca") %>
<% } %>
<% if (stores?.[state.code]?.rite_aid) { %>
  <% storesScanning.push("Rite Aid") %>
<% } %>
<% if (stores?.[state.code]?.albertsons) { %>
  <% storesScanning.push("Safeway/Albertsons") %>
<% } %>
<% if (stores?.[state.code]?.sams_club) { %>
  <% storesScanning.push("Sam's Club") %>
<% } %>
<% if (stores?.[state.code]?.thrifty_white) { %>
  <% storesScanning.push("Thrifty White") %>
<% } %>
<% if (stores?.[state.code]?.walgreens) { %>
  <% storesScanning.push("Walgreens") %>
<% } %>
<% if (stores?.[state.code]?.walmart) { %>
  <% storesScanning.push("Walmart") %>
<% } %>
<% providerLastFetched = {} %>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.vaccinespotter.org<%= page.url %>" />
    <meta property="og:title" content="<%= title %>" />
    <meta property="og:description" content="<%= description %>" />
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@nickblah" />
    <meta property="twitter:title" content="<%= title %>" />
    <meta property="twitter:description" content="<%= description %>" />

    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <script defer src="https://use.fontawesome.com/releases/v5.15.2/js/all.js" integrity="sha384-vuFJ2JiSdUpXLKGK+tDteQZBqNlMwAjhZ3TvPaDfN9QmbPb7Q8qUpbSNapQev3YF" crossorigin="anonymous"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49484378-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-49484378-1');
    </script>
    <style>
    .resp-sharing-button__link,
    .resp-sharing-button__icon {
      display: inline-block
    }

    .resp-sharing-button__link,
    .resp-sharing-button__link:hover {
      text-decoration: none;
      color: #fff;
      margin: 0.5em
    }

    .resp-sharing-button {
      border-radius: 5px;
      transition: 25ms ease-out;
      padding: 0.5em 0.75em;
      font-family: Helvetica Neue,Helvetica,Arial,sans-serif
    }

    .resp-sharing-button__icon svg {
      width: 1em;
      height: 1em;
      margin-right: 0.4em;
      vertical-align: top
    }

    .resp-sharing-button--small svg {
      margin: 0;
      vertical-align: middle
    }

    /* Non solid icons get a stroke */
    .resp-sharing-button__icon {
      stroke: #fff;
      fill: none
    }

    /* Solid icons get a fill */
    .resp-sharing-button__icon--solid,
    .resp-sharing-button__icon--solidcircle {
      fill: #fff;
      stroke: none
    }

    .resp-sharing-button--twitter {
      background-color: #55acee
    }

    .resp-sharing-button--twitter:hover {
      background-color: #2795e9
    }

    .resp-sharing-button--pinterest {
      background-color: #bd081c
    }

    .resp-sharing-button--pinterest:hover {
      background-color: #8c0615
    }

    .resp-sharing-button--facebook {
      background-color: #3b5998
    }

    .resp-sharing-button--facebook:hover {
      background-color: #2d4373
    }

    .resp-sharing-button--tumblr {
      background-color: #35465C
    }

    .resp-sharing-button--tumblr:hover {
      background-color: #222d3c
    }

    .resp-sharing-button--reddit {
      background-color: #5f99cf
    }

    .resp-sharing-button--reddit:hover {
      background-color: #3a80c1
    }

    .resp-sharing-button--google {
      background-color: #dd4b39
    }

    .resp-sharing-button--google:hover {
      background-color: #c23321
    }

    .resp-sharing-button--linkedin {
      background-color: #0077b5
    }

    .resp-sharing-button--linkedin:hover {
      background-color: #046293
    }

    .resp-sharing-button--email {
      background-color: #777
    }

    .resp-sharing-button--email:hover {
      background-color: #5e5e5e
    }

    .resp-sharing-button--xing {
      background-color: #1a7576
    }

    .resp-sharing-button--xing:hover {
      background-color: #114c4c
    }

    .resp-sharing-button--whatsapp {
      background-color: #25D366
    }

    .resp-sharing-button--whatsapp:hover {
      background-color: #1da851
    }

    .resp-sharing-button--hackernews {
    background-color: #FF6600
    }
    .resp-sharing-button--hackernews:hover, .resp-sharing-button--hackernews:focus {   background-color: #FB6200 }

    .resp-sharing-button--vk {
      background-color: #507299
    }

    .resp-sharing-button--vk:hover {
      background-color: #43648c
    }

    .resp-sharing-button--facebook {
      background-color: #3b5998;
      border-color: #3b5998;
    }

    .resp-sharing-button--facebook:hover,
    .resp-sharing-button--facebook:active {
      background-color: #2d4373;
      border-color: #2d4373;
    }

    .resp-sharing-button--twitter {
      background-color: #55acee;
      border-color: #55acee;
    }

    .resp-sharing-button--twitter:hover,
    .resp-sharing-button--twitter:active {
      background-color: #2795e9;
      border-color: #2795e9;
    }

    .resp-sharing-button--tumblr {
      background-color: #35465C;
      border-color: #35465C;
    }

    .resp-sharing-button--tumblr:hover,
    .resp-sharing-button--tumblr:active {
      background-color: #222d3c;
      border-color: #222d3c;
    }

    .resp-sharing-button--email {
      background-color: #777777;
      border-color: #777777;
    }

    .resp-sharing-button--email:hover,
    .resp-sharing-button--email:active {
      background-color: #5e5e5e;
      border-color: #5e5e5e;
    }

    .resp-sharing-button--pinterest {
      background-color: #bd081c;
      border-color: #bd081c;
    }

    .resp-sharing-button--pinterest:hover,
    .resp-sharing-button--pinterest:active {
      background-color: #8c0615;
      border-color: #8c0615;
    }

    .resp-sharing-button--linkedin {
      background-color: #0077b5;
      border-color: #0077b5;
    }

    .resp-sharing-button--linkedin:hover,
    .resp-sharing-button--linkedin:active {
      background-color: #046293;
      border-color: #046293;
    }

    .resp-sharing-button--reddit {
      background-color: #5f99cf;
      border-color: #5f99cf;
    }

    .resp-sharing-button--reddit:hover,
    .resp-sharing-button--reddit:active {
      background-color: #3a80c1;
      border-color: #3a80c1;
    }

    .resp-sharing-button--whatsapp {
      background-color: #25D366;
      border-color: #25D366;
    }

    .resp-sharing-button--whatsapp:hover,
    .resp-sharing-button--whatsapp:active {
      background-color: #1DA851;
      border-color: #1DA851;
    }

    .resp-sharing-button--hackernews {
      background-color: #FF6600;
      border-color: #FF6600;
    }

    .resp-sharing-button--hackernews:hover
    .resp-sharing-button--hackernews:active {
      background-color: #FB6200;
      border-color: #FB6200;
    }

    body {
      padding-top: 100px;
    }

    h1.navbar-brand {
      font-size: 1rem;
    }

    @media (min-width: 768px) {
      body {
        padding-top: 50px;
      }
    }

    @media (min-width: 360px) {
      h1.navbar-brand {
        font-size: 1.25rem;
      }
    }

    h2.brand {
      margin-bottom: 0px;
    }

    .brand-link {
      margin-bottom: 0.5rem;
    }

    .brand-link a svg {
      margin-left: 4px;
    }

    .text-warning {
      color: #d99011 !important;
    }
    </style>

    <!-- Leaflet map styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" integrity="sha512-RLEjtaFGdC4iQMJDbMzim/dOvAu+8Qp9sw7QE4wIMYcg2goVoivzwgSZq9CsIxp4xKAZPKh5J2f2lOko2Ze6FQ==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" integrity="sha512-BBToHPBStgMiw0lD4AtkRIZmdndhB6aQbXpX7omcrXeG2PauGBl2lzq2xUZTxaLxYz5IDHlmneCZ1IJ+P3kYtQ==" crossorigin="anonymous" />

    <!-- jQuery used to trigger Leaflet loads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta2/js/bootstrap.bundle.min.js" integrity="sha512-43iShtbiyImxjjU4a9rhXBy7eKtIsrpll8xKhe1ghKqh5NyfME8phZs5JRFZpRBe1si44WM3tNmnqMym7JRmDQ==" crossorigin="anonymous"></script>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js" integrity="sha512-MQlyPV+ol2lp4KodaU/Xmrn+txc1TP15pOBF/2Sfre7MRsA/pB4Vy58bEqe9u7a7DczMLtU5wT8n7OblJepKbg==" crossorigin="anonymous"></script>

    <!-- Open Street Map helper for Leaflet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-providers/1.11.0/leaflet-providers.min.js" integrity="sha512-TO+Wd5hbpDsACTmvzSqAZL83jMQCXGRFNoS4WZxcxrlJBTdgMYaT7g5uX49C5+Kbuxzlg2A+TFJ6UqdsXuOKLw==" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>
      <div class="navbar fixed-top navbar-dark bg-primary shadow">
        <div class="container">
          <h1 class="navbar-brand mb-0 fw-bold"><a href="/" class="text-white" style="text-decoration: none;"><%= title %></a></h1>
          <div class="d-flex">
            <button class="btn btn-light" onclick="window.location.reload();"><i class="fas fa-redo-alt"></i> Check for New Appointments</button>
          </div>
        </div>
      </div>
    </header>
    <main>
      <div class="container">
        <p class="lead text-center text-muted py-lg-4"><%= description %></p>

        <div class="row mb-2">
          <div class="col-md-6 pb-3">
            <div class="card card-body h-100 bg-primary text-white shadow-sm">
              <h2 class="display-6 text-center mb-4">Step 1: Review your county's availability and <%= state.code %>'s eligibility</h2>
              <% if (state.code === "CO") { %>
                <p class="lead">Visit <a href="https://covid19.colorado.gov/for-coloradans/vaccine/where-can-i-get-vaccinated" class="text-white"><strong class="fw-bold">Colorado.gov</strong></a> for detailed information about your county's vaccine options and review whether or not you are eligible yet.</p>
                <p class="lead">You may be able to signup for vaccines with a health care provider in your area (Kaiser, SCL Health, your county, etc.), in which case you will be contacted when it's your turn and you may not need this tool.</p>
                <a href="https://covid19.colorado.gov/for-coloradans/vaccine/where-can-i-get-vaccinated" class="btn btn-light fw-bold fs-5 text-primary">Visit Colorado.gov <i class="fas fa-arrow-alt-circle-right"></i></a>
              <% } else { %>
                <p class="lead">Be sure to visit your own state's official vaccination website for detailed information about your county's vaccine options and review whether or not you are eligible yet.</p>
                <p class="lead">You may be able to signup for vaccines with a health care provider or there may be other options in your area, in which case you may not need this tool.</p>
              <% } %>
            </div>
          </div>
          <div class="col-md-6 pb-3">
            <div class="card card-body h-100 bg-primary text-white shadow-sm">
              <h2 class="display-6 text-center mb-4">Step 2: Use this tool to try and find a pharmacy appointment</h2>
              <p class="lead">If you decide you want to find an appointment at a local pharmacy (and are currently eligible for the vaccine), this tool might be able to help.</p>
              <p class="lead">Rather than searching around on each pharmacy's website, we'll automatically scan the pharmacy websites and show you any available appointments we can find on one page.</p>
              <p class="lead">All <%= this.listify(storesScanning) %> locations in <%= state.name %> are scanned on a regular basis and this page is updated with any available appointments in the state. If you don't see locations near you right now, appointments can come and go quickly so try visiting the page at different times throughout the day.</p>
            </div>
          </div>
        </div>

        <div class="alert alert-info" role="alert">
          <p class="mb-0"><strong>03/03/2021:</strong> <strong>Thrifty White</strong> locations are now being scanned in all supported states (Iowa, Minnesota, and North Dakota). ðŸ¥³ Hope these additional locations help you! Any feedback is welcome: <a href="m&#97;ilto&#58;v%&#54;1&#99;&#99;&#105;ne&#64;nic&#107;%6D&#46;org">vacc&#105;ne&#64;ni&#99;k&#109;&#46;o&#114;&#103;</a> or <a href="https://twitter.com/nickblah">@nickblah</a>. And if you're a coder and have interest in helping out on <a href="https://github.com/GUI/covid-vaccine-finder/issues">GitHub</a>, that would be dandy (although the code's still messy)!</p>
        </div>

        <div id="map" class="w-100" style="min-height: 400px;"></div>

        <% if (stores?.[state.code]?.cvs) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].cvs.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.cvs = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">CVS Appointments</h2>
          <div class="brand-link"><a href="https://www.cvs.com/immunizations/covid-19-vaccine" target="_blank">CVS Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/cvsAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.heb) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].heb.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.heb = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">H-E-B Pharmacy Appointments</h2>
          <div class="brand-link"><a href="https://vaccine.heb.com/scheduler" target="_blank">H-E-B Pharmacy Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/hebAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.kroger) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].kroger.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.kroger = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">King Soopers, City Market Pharmacy Appointments</h2>
          <div class="brand-link"><a href="https://www.kingsoopers.com/rx/covid-eligibility" target="_blank">King Soopers Pharmacy Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/krogerAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.pharmaca) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].pharmaca.filter((s) => s.appointments_last_fetched), ['lastFetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.pharmaca = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Pharmaca Appointments</h2>
          <div class="brand-link"><a href="https://www.pharmacarx.com/covid-vaccine-faqs/" target="_blank">Pharmaca Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/pharmacaAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.rite_aid) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].rite_aid.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.rite_aid = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Rite Aid Appointments</h2>
          <div class="brand-link"><a href="https://www.riteaid.com/pharmacy/covid-qualifier" target="_blank">Rite Aid Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/riteAidAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.albertsons) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].albertsons.filter((s) => s.appointments_last_fetched), ['lastFetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.albertsons = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Safeway, Albertsons Pharmacy Appointments</h2>
          <div class="brand-link"><a href="https://www.safeway.com/pharmacy/covid-19.html" target="_blank">Safeway Pharmacy Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/albertsonsAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.sams_club) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].sams_club.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.sams_club = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Sam's Club Pharmacy Appointments</h2>
          <div class="brand-link"><a href="https://www.samsclub.com/pharmacy/immunization/form?imzType=covid" target="_blank">Sam's Club Pharmacy Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/samsClubAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.thrifty_white) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].thrifty_white.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.thrifty_white = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Thrifty White Appointments</h2>
          <div class="brand-link"><a href="https://www.thriftywhite.com/covid19vaccine" target="_blank">Thrifty White Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/thriftyWhiteAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.walgreens) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].walgreens.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.walgreens = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Walgreens Appointments</h2>
          <div class="brand-link"><a href="https://www.walgreens.com/findcare/vaccination/covid-19/location-screening" target="_blank">Walgreens Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/walgreensAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>

        <% if (stores?.[state.code]?.walmart) { %>
          <% appointments = this.lodash.orderBy(stores[state.code].walmart.filter((s) => s.appointments_last_fetched), ['appointments_last_fetched'], ['desc']) %>
          <% lastFetched = appointments?.[0]?.appointments_last_fetched %>
          <% if(!lastFetched && !appointments?.[0]?.carries_vaccine) { %>
            <% lastFetched = (new Date()).toISOString() %>
          <% } %>
          <% lastFetchedDate = (lastFetched) ? new Date(lastFetched) : null %>
          <% providerLastFetched.walmart = lastFetchedDate %>
          <h2 class="brand" data-last-fetched="<%= lastFetched %>">Walmart Pharmacy Appointments</h2>
          <div class="brand-link"><a href="https://www.walmart.com/pharmacy/clinical-services/immunization/scheduled?imzType=covid" target="_blank">Walmart Pharmacy Website<i class="fas fa-external-link-alt"></i></a></div>
          <% availableAppointments = this.lodash.orderBy(this.lodash.filter(appointments, 'appointments_available').filter((s) => this.luxon.DateTime.fromISO(s.appointments_last_fetched) >= this.luxon.DateTime.utc().minus({ minutes: 45 })), ['city', 'address']) %>
          <% if(availableAppointments.length > 0) { %>
            <% availableAppointments.forEach((store) => { %>
              <%- include('./_includes/walmartAppointment', { store }) %>
            <% }) %>
          <% } else { %>
            <p class="mb-0">No appointments available at any locations as of last check.</p>
            <% if(lastFetched) { %>
              <p class="card-text text-secondary"><small>Last checked <%- include('/localTime', { time: lastFetchedDate, timeZone: 'America/New_York' }) %></small></p>
            <% } %>
          <% } %>
        <% } %>
      </div>
    </main>
    <footer class="mt-3">
      <div class="container">
        <h3>Tool Status</h3>
        <ul>
          <% if (stores?.[state.code]?.cvs) { %>
            <li><strong>CVS:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.cvs, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking <%= stores[state.code].cvs.length %> <%= (stores[state.code].cvs.length === 1) ? 'city' : 'cities' %> (new cities will be added as CVS adds them).</li>
          <% } %>
          <% if (stores?.[state.code]?.heb) { %>
            <li><strong>H-E-B Pharmacy:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.heb, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking <%= stores[state.code].heb.length %> <%= (stores[state.code].heb.length === 1) ? 'city' : 'cities' %> (new cities will be added as CVS adds them).</li>
          <% } %>
          <% if (stores?.[state.code]?.pharmaca) { %>
            <li><strong>Pharmaca:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.pharmaca, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].pharmaca.length %> <%= (stores[state.code].pharmaca.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.rite_aid) { %>
            <li><strong>Rite Aid:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.rite_aid, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].rite_aid.length %> <%= (stores[state.code].rite_aid.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.albertsons) { %>
            <li><strong>Safeway, Albertsons:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.albertsons, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].albertsons.length %> <%= (stores[state.code].albertsons.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.sams_club) { %>
            <li><strong>Sam's Club:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.sams_club, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].sams_club.length %> <%= (stores[state.code].sams_club.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.thrifty_white) { %>
            <li><strong>Thrifty White:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.thrifty_white, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].thrifty_white.length %> <%= (stores[state.code].thrifty_white.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.walgreens) { %>
            <li><strong>Walgreens:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.walgreens, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].walgreens.length %> <%= (stores[state.code].walgreens.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.walmart) { %>
            <li><strong>Walmart:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.walmart, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].walmart.length %> <%= (stores[state.code].walmart.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
          <% if (stores?.[state.code]?.kroger) { %>
            <li><strong>King Soopers, City Market, Dillons, Smith's:</strong> Last checked <%- include('/localTime', { time: providerLastFetched.kroger, timeZone: 'America/New_York' }).replace(/\s*$/, '') %>. Checking all <%= stores[state.code].kroger.length %> <%= (stores[state.code].kroger.length === 1) ? 'store' : 'stores' %> in <%= state.code %>.</li>
          <% } %>
        </ul>

        <p>View the status of <a href="/<%= state.code %>/all/">all locations being scanned</a> (including those locations without open appointments).</p>

        <h3>About</h3>
        <p>Finding vaccines seems tough! Hopefully things will become easier soon, but in the meantime, maybe this can help. If you find this useful, feel free to share it around. Get in touch with any questions: <a href="m&#97;ilto&#58;v%&#54;1&#99;&#99;&#105;ne&#64;nic&#107;%6D&#46;org">vacc&#105;ne&#64;ni&#99;k&#109;&#46;o&#114;&#103;</a>, <a href="https://twitter.com/nickblah">@nickblah</a>, or <a href="https://github.com/GUI/covid-vaccine-finder/issues">GitHub</a>.</p>
        <p>I'd like to add additional functionality (scanning additional pharmacies and sending e-mail or text notifications when appointments open up) if this proves useful and as time permits. If you're a computer programmer and would like to contribute, the project is <a href="https://github.com/GUI/covid-vaccine-finder">open source on GitHub</a> (it's currently very messy and undocumented, though).</p>

        <div class="text-center mb-3">
          <span style="display: inline-block; max-width: 620px;">
            <!-- Sharingbutton Facebook -->
            <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.vaccinespotter.org" target="_blank" rel="noopener" aria-label="Share on Facebook">
              <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
                </div>Share on Facebook</div>
            </a>

            <!-- Sharingbutton Twitter -->
            <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.&amp;url=https%3A%2F%2Fwww.vaccinespotter.org" target="_blank" rel="noopener" aria-label="Share on Twitter">
              <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
                </div>Share on Twitter</div>
            </a>

            <!-- Sharingbutton Tumblr -->
            <a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.&amp;caption=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.&amp;content=https%3A%2F%2Fwww.vaccinespotter.org&amp;canonicalUrl=https%3A%2F%2Fwww.vaccinespotter.org&amp;shareSource=tumblr_share_button" target="_blank" rel="noopener" aria-label="Share on Tumblr">
              <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.5.5v5h5v4h-5V15c0 5 3.5 4.4 6 2.8v4.4c-6.7 3.2-12 0-12-4.2V9.5h-3V6.7c1-.3 2.2-.7 3-1.3.5-.5 1-1.2 1.4-2 .3-.7.6-1.7.7-3h3.8z"/></svg>
                </div>Share on Tumblr</div>
            </a>

            <!-- Sharingbutton E-Mail -->
            <a class="resp-sharing-button__link" href="mailto:?subject=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.&amp;body=https%3A%2F%2Fwww.vaccinespotter.org" target="_self" rel="noopener" aria-label="Share by E-Mail">
              <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>Share by E-Mail</div>
            </a>

            <!-- Sharingbutton Pinterest -->
            <a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fwww.vaccinespotter.org&amp;media=https%3A%2F%2Fwww.vaccinespotter.org&amp;description=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute." target="_blank" rel="noopener" aria-label="Share on Pinterest">
              <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.14.5C5.86.5 2.7 5 2.7 8.75c0 2.27.86 4.3 2.7 5.05.3.12.57 0 .66-.33l.27-1.06c.1-.32.06-.44-.2-.73-.52-.62-.86-1.44-.86-2.6 0-3.33 2.5-6.32 6.5-6.32 3.55 0 5.5 2.17 5.5 5.07 0 3.8-1.7 7.02-4.2 7.02-1.37 0-2.4-1.14-2.07-2.54.4-1.68 1.16-3.48 1.16-4.7 0-1.07-.58-1.98-1.78-1.98-1.4 0-2.55 1.47-2.55 3.42 0 1.25.43 2.1.43 2.1l-1.7 7.2c-.5 2.13-.08 4.75-.04 5 .02.17.22.2.3.1.14-.18 1.82-2.26 2.4-4.33.16-.58.93-3.63.93-3.63.45.88 1.8 1.65 3.22 1.65 4.25 0 7.13-3.87 7.13-9.05C20.5 4.15 17.18.5 12.14.5z"/></svg>
                </div>Share on Pinterest</div>
            </a>

            <!-- Sharingbutton LinkedIn -->
            <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.vaccinespotter.org&amp;title=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.&amp;summary=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.&amp;source=https%3A%2F%2Fwww.vaccinespotter.org" target="_blank" rel="noopener" aria-label="Share on LinkedIn">
              <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
                </div>Share on LinkedIn</div>
            </a>

            <!-- Sharingbutton Reddit -->
            <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A%2F%2Fwww.vaccinespotter.org&amp;resubmit=true&amp;title=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute." target="_blank" rel="noopener" aria-label="Share on Reddit">
              <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>
                </div>Share on Reddit</div>
            </a>

            <!-- Sharingbutton WhatsApp -->
            <a class="resp-sharing-button__link" href="whatsapp://send?text=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute.%20https%3A%2F%2Fwww.vaccinespotter.org" target="_blank" rel="noopener" aria-label="Share on WhatsApp">
              <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3 0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7 0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1 0-5.2 4.2-9.4 9.4-9.4 2.5 0 4.9 1 6.7 2.8 1.8 1.8 2.8 4.2 2.8 6.7-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2-.2-.3 0-.5.1-.6s.3-.3.4-.5c.2-.1.3-.3.4-.5.1-.2 0-.4 0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg>
                </div>Share on WhatsApp</div>
            </a>

            <!-- Sharingbutton Hacker News -->
            <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fwww.vaccinespotter.org&amp;t=COVID-19%20Vaccine%20Spotter.%20A%20tool%20to%20help%20you%20track%20down%20COVID-19%20vaccine%20appointment%20openings%20at%20pharmacies.%20Updated%20every%20minute." target="_blank" rel="noopener" aria-label="Share on Hacker News">
              <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg>
                </div>Share on Hacker News</div>
            </a>
          </span>
        </div>

        <p class="text-center mx-3">For Developers: <a href="/api/">Very Beta API</a> | <a href="https://github.com/GUI/covid-vaccine-finder">GitHub</a></p>
      </div>
    </footer>

    <script type="text/javascript">
      try {
        var brands = document.querySelectorAll('h2.brand[data-last-fetched]');
        var now = Date.now();
        for (var i = 0; i < brands.length; i++) {
          var brand = brands[i];
          var lastFetched = new Date(brand.getAttribute('data-last-fetched'));
          if (lastFetched.getTime() < (now - 1000 * 60 * 30)) {
            if (brand.innerText.indexOf('King Soopers') !== -1) {
              brand.nextElementSibling.insertAdjacentHTML('afterend', '<div class="alert alert-warning" role="alert"><i class="fas fa-exclamation-triangle"></i> <strong>Uh oh!</strong> It looks like the data for this store is older than 30 minutes. King Soopers is blocking our tool from accessing its data. We\'ve tried to employ some workarounds, so this will still sometimes update, but it\'s prone to breaking, so unfortunately this is somewhat expected right now. We\'ve reached out to King Soopers to try and resolve this. Sorry!</div>');
            } else {
              brand.nextElementSibling.insertAdjacentHTML('afterend', '<div class="alert alert-warning" role="alert"><i class="fas fa-exclamation-triangle"></i> <strong>Uh oh!</strong> It looks like the data for this store is older than 30 minutes. This might mean this tool is being blocked from accessing this store\'s data or something has broken on our end. We\'ll try to get this fixed, but in the meantime, please visit the store\'s website directly.</div>');
            }
          }
        }
      } catch (err) {
        if (console.error) {
          console.error(err);
        }
      }
    </script>

    <script type="text/javascript">
      // List of JSON sources to load for this state
      const list = [
        <% for (const state of this.lodash.orderBy(states, 'code')) { %>
          <% if (stores?.[state.code]) { %>
            <% for (const brand of Object.keys(stores?.[state.code]).sort()) { %>
              "/api/v0/stores/<%= state.code %>/<%= brand %>.json",
            <% } %>
          <% } %>
        <% } %>
      ];

      var map = null;
      var points = [];

      var markers = L.markerClusterGroup({
        showCoverageOnHover: false,
        iconCreateFunction: function (cluster) {
          var markers = cluster.getAllChildMarkers();
          var ids = markers.map(function(item) { return item.sourceId; });
          
          // We determine if it is green (all open), yellow (some open), or red (none open)
          var p = points.filter(function(a) { return ids.includes(a.id) });
          var stale =p.filter(function(a) { return a.is_stale == true }); 
          var open = p.filter(function(a) { return a.appointments_available == true });

          if (p.length == stale.length) {
            // Everything is stale
            colorClass = "bg-secondary";
            textClass = "text-white";
          } else if (p.length == open.length) {
            // Everything is current + has appointments
            colorClass = "bg-success";
            textClass = "text-white";
          } else if (open.length == 0) {
            // Everything doesn't have appointments
            colorClass = "bg-danger";
            textClass = "text-white";
          } else {
            // Mixture
            colorClass = "bg-warning";
            textClass = "text-dark";
          }

          return L.divIcon({ html: "<div class='" + textClass + "'><span>" + p.length + "</span></div>", className: 'marker-cluster ' + colorClass, iconSize: L.point(40, 40) });
        }
      });

      function loadMap() {
        // Start in the center of the contiguous US
        map = L.map('map').setView([39.8282, -98.5696], 6);

        // Add the OSM layer
        new L.tileLayer.provider('OpenStreetMap.Mapnik').addTo(map);

        // Add the marker layer
        map.addLayer(markers);

        // Need to go through and load each source
        $.each(list, function(index, value) { $.getJSON(value, null, loadSource) });
      }

      function fitNewBounds() {
        if (points.length == 0) return;

        var llon = Math.min(...points.map(function(a) { return a.longitude }));
        var ulon = Math.max(...points.map(function(a) { return a.longitude }));
        var llat = Math.min(...points.map(function(a) { return a.latitude }));
        var ulat = Math.max(...points.map(function(a) { return a.latitude }));

        if (isNaN(llon) || isNaN(ulon) || isNaN(llat) || isNaN(ulat)) return;

        map.fitBounds([
            [ulat, llon],
            [llat, ulon]
        ]);
      }

      function loadSource(data, textStatus) {
        // We've loaded a list, need to add it to our points
        data.forEach(function(item) {
          // If we're on the list, skip for now
          //if (points.filter(function (a) { a.id == item.id }).length > 0) continue;

          // New point, let's work it
          addPoint(item);
        });

        fitNewBounds();
      }

      function addPoint(item) {
        // If they don't carry vaccine, we do nothing
        // REMOVED because this may skip providers who will carry it down the road
        //if (item.carries_vaccine != true) return;

        // No point will be exactly zero,zero
        if (item.latitude == null || item.latitude == 0 || item.longitude == null || item.longitude == 0) return;

        // Bootstrap default success and danger colors
        var last_fetched = Date.parse(item.appointments_last_fetched);
        item.is_stale = isNaN(last_fetched) || last_fetched < (Date.now() - 1000 * 60 * 30);
        var color = item.is_stale ? "#6c757d" : (item.appointments_available == true ? "#28a745" : "#dc3545");
        var size = !item.is_stale && item.appointments_available == true ? 6 : 3;

        item.marker = L.circleMarker({lat: item.latitude, lon: item.longitude}, {radius: size, color: color, fillOpacity: 1, fillColor: color});

        // Save the ID to the marker because we will reference it later
        item.marker.sourceId = item.id;

        // Bind the popup
        item.marker.bindPopup(
          "<p>" +
          (item.name != null ? "<span class='font-weight-bold'>" + item.name + "</span><br /><br />" : "")
          +
            (item.is_stale ? "<span class='text-danger font-weight-bold'>STALE DATA</span><br />" : "")
            +
            "<span class='font-weight-bold'>Appointments Available:</span> " + (item.appointments_available == true ? "Yes" : "No") + "<br />"
            +
            (item.address != null && item.city != null && item.state != null && item.postal_code != null ? item.address + "<br />" + item.city + ", " + item.state + " " + item.postal_code + "<br />" : "")
          + "</p>"
        );

        // Add to the map
        markers.addLayer(item.marker);

        // Add to our list
        points.push(item);
      }

      /* On load functions */
      $(function() { loadMap(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/custom-elements/1.4.3/custom-elements.min.js" integrity="sha512-PLDz+cN5TNZKRezSF9Zk+n/TTHG6ISM466kmCQkFcIkp4Mw+1S15qnvEsd5pyMNOlOMp9hGz6YS9eusXqh0rnA==" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@github/time-elements@3.1.1"></script>
  </body>
</html>
